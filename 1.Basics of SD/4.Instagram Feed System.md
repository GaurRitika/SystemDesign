# ğŸ“¸ Case Study: Instagram Feed System

Letâ€™s say the interviewer asks:

> â€œDesign Instagramâ€™s News Feed â€” how would you estimate the systemâ€™s capacity?â€

Youâ€™ll say:

> â€œLetâ€™s first do **capacity estimation** to understand what scale weâ€™re designing for.â€

---

## ğŸ§© Phase 1: Define the Problem Clearly

We are focusing on:

* **News Feed** = fetching posts of users someone follows.
* Not messaging, stories, or videos â€” just feed generation and viewing.

---

## ğŸ§© Phase 2: State Assumptions

You must clearly mention your assumptions (shows clarity).

Letâ€™s assume:

| Metric                          | Value            | Notes                              |
| ------------------------------- | ---------------- | ---------------------------------- |
| Total Users                     | 100 million      | (MAU)                              |
| Daily Active Users (DAU)        | 50 million       | 50% active daily                   |
| Average Posts per User/day      | 2 posts/day      | includes photos & reels thumbnails |
| Average Followers per User      | 200 followers    | follower graph density             |
| Average Feed Views per User/day | 5 feed refreshes | each refresh loads ~20 posts       |
| Average Image Size              | 200 KB           | compressed JPEG                    |
| Average Post Metadata           | 500 bytes        | text, likes count, etc.            |
| Peak Load Factor                | 2Ã—               | traffic spikes at morning/evening  |

---

## ğŸ§© Phase 3: Estimate Write Load (When Users Post)

Each active user uploads **2 posts/day**.

### ğŸ§® Total Posts per Day

```
= 50M active users Ã— 2 posts
= 100 million new posts/day
```

### ğŸ§® Data Size per Post

Each post:

* Image: 200 KB
* Metadata: 0.5 KB
  â†’ Total â‰ˆ 200.5 KB â‰ˆ **~200 KB** per post.

### ğŸ§® Total Data Generated per Day

```
= 100M Ã— 200 KB
= 20,000,000,000 KB
= 20 TB/day
```

âœ… So, **Instagram generates ~20 TB of new photo data every day.**

This goes into:

* **Blob storage (like AWS S3)**
* **Metadata DB (like Cassandra/MySQL)**

---

## ğŸ§© Phase 4: Estimate Read Load (When Users View Feeds)

Each user refreshes feed **5 times/day**.
Each refresh loads **20 posts** â†’ **100 posts/day per user**.

### ğŸ§® Total Feed Posts Delivered Per Day

```
= 50M users Ã— 100 posts
= 5 billion posts/day served
```

Each post is about 200 KB (image + metadata).

```
5B Ã— 200 KB = 1,000,000,000,000 KB = 1 PB/day (Petabyte!)
```

âœ… So the feed delivery side moves roughly **1 petabyte/day** of data to users.

Thatâ€™s **massive**, which is why caching and CDNs are *critical*.

---

## ğŸ§© Phase 5: Calculate Requests Per Second (RPS)

Now letâ€™s find the throughput â€” how many requests per second Instagramâ€™s servers must handle.

There are **two main operations**:

1. **Feed reads** (fetching posts)
2. **Post uploads** (writing new posts)

Letâ€™s convert daily numbers â†’ per second.

### ğŸ§® Feed Read RPS

```
Feed reads/day = 50M users Ã— 5 = 250M feed requests/day
= 250M / 86400 â‰ˆ 2,893 reads/sec (avg)
Peak â‰ˆ 2 Ã— 2,893 = 5,786 reads/sec
```

But each feed request fetches **20 posts**, so:

```
Total post reads/sec = 5,786 Ã— 20 = 115,720 post reads/sec
```

âœ… Roughly **~100K post reads/sec**.

---

### ğŸ§® Post Write RPS

```
Posts/day = 100M
= 100M / 86400 â‰ˆ 1,157 posts/sec (avg)
Peak â‰ˆ 2 Ã— 1,157 = 2,314 writes/sec
```

âœ… Roughly **~2K writes/sec**.

---

### Summary of Throughput

| Operation              | Avg RPS | Peak RPS | Notes                                 |
| ---------------------- | ------- | -------- | ------------------------------------- |
| Post Upload            | 1.1K    | 2.3K     | write-heavy but less frequent         |
| Feed Fetch             | 58K     | 115K     | read-heavy                            |
| Image Fetch (from CDN) | ~1M     | ~2M      | actual image delivery at global scale |

---

## ğŸ§© Phase 6: Estimate Storage

We already saw:

* 20 TB/day of new posts.

Now, suppose we keep data for **5 years**.

```
20 TB/day Ã— 365 Ã— 5 = 36,500 TB = 36.5 PB (Petabytes!)
```

âœ… Instagram would need **tens of petabytes** for image storage â€” which aligns with real-world CDN + blob storage systems.

---

### Metadata (like post info, likes, comments)

Letâ€™s assume metadata = 500 bytes/post.

```
100M posts/day Ã— 500 bytes = 50 GB/day
For 5 years = 50 GB Ã— 365 Ã— 5 = 91 TB
```

So:

* **Image storage (S3)** â†’ 36 PB
* **Metadata storage (DB)** â†’ ~100 TB

---

## ğŸ§© Phase 7: Estimate Bandwidth Usage

### ğŸ§® Upload Bandwidth

Post upload = 200 KB each Ã— 2.3K uploads/sec = 460 MB/sec

â†’ **~3.7 Gbps** for uploads (to servers).

### ğŸ§® Download Bandwidth (Serving Feeds)

100K posts/sec Ã— 200 KB = 20,000,000 KB/sec = 20 GB/sec

â†’ **~160 Gbps** outgoing bandwidth!

Hence, **Instagram uses CDNs (like Akamai, CloudFront, or its own edge servers)** to serve static content near users and reduce bandwidth load.

---

## ğŸ§© Phase 8: Estimate Server Count

Letâ€™s assume:

* 1 web server can handle ~500 RPS comfortably
* 1 feed request â‰ˆ 1 complex query (maybe multiple microservices)

### App Servers

For 115K RPS (peak feed reads):

```
115K / 500 = 230 servers
Add 30% buffer = ~300 servers
```

### DB Servers

Writes: 2K RPS â†’ easily handled by a **sharded DB cluster**
Reads: 100K/sec â†’ use caching + replicas

Assume:

* Each DB shard can handle ~5K RPS
* Need 20â€“30 read replicas (with caching in front)

âœ… App servers â‰ˆ 300
âœ… DB shards â‰ˆ 20â€“30
âœ… Cache nodes (Redis) â‰ˆ 50â€“100
âœ… CDN edges = hundreds globally

---

## ğŸ§© Phase 9: Cache Estimation

80% of feed reads are served from cache.

```
Total post reads/day = 5B
Cache hit ratio = 80% â†’ 4B cache hits/day
```

Each post = 200 KB

```
4B Ã— 200 KB = 800 TB/day (cached content served)
```

Assume cache stores only recent posts (~7 days old).

```
100M posts/day Ã— 7 = 700M posts
Each = 200 KB â†’ 140 TB cache size
```

âœ… Cache cluster needs ~140 TB total memory
â†’ spread across many Redis or Memcached nodes.

---

## ğŸ§© Phase 10: Scalability Insights

From these numbers, we learn:

| Component       | Scaling Method                      | Reason                                   |
| --------------- | ----------------------------------- | ---------------------------------------- |
| Web/App Servers | Horizontal scaling                  | To handle user traffic                   |
| Databases       | Sharding + Replication              | To handle 2K writes/sec + 100K reads/sec |
| Cache           | Distributed cache (Redis/Memcached) | To handle hot feed reads                 |
| Image Storage   | Blob storage + CDN                  | For petabytes of images                  |
| Bandwidth       | CDNs + Compression                  | To reduce latency & cost                 |

---

## âš™ï¸ Final Summary Table

| Metric                  | Value     |
| ----------------------- | --------- |
| Total Users             | 100M      |
| DAU                     | 50M       |
| New Posts/day           | 100M      |
| Feed Requests/day       | 250M      |
| Peak Feed RPS           | ~115K     |
| Peak Post Writes        | ~2K       |
| Data Ingestion/day      | ~20 TB    |
| Image Storage (5 years) | ~36 PB    |
| App Servers             | ~300      |
| Cache Memory            | ~140 TB   |
| Outgoing Bandwidth      | ~160 Gbps |

---

## ğŸ§  Key Takeaways

1. **Instagramâ€™s scale is dominated by reads (feeds)**, not writes (uploads).
2. **Caching and CDN are absolutely essential** â€” without them, bandwidth and latency would kill the system.
3. **Metadata storage** (likes, comments) fits in distributed databases.
4. **Feed generation** uses background workers and fanout queues (weâ€™ll discuss later).
5. **Capacity planning is not exact â€” itâ€™s directional**, showing you understand which parts of the system are heavy.

---

âœ… **So, capacity estimation helps you answer:**

> â€œHow big should my system be, and where are the bottlenecks likely to appear?â€

---

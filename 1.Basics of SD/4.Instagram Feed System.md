#  Case Study: Instagram Feed System

Let’s say the interviewer asks:

> “Design Instagram’s News Feed — how would you estimate the system’s capacity?”

You’ll say:

> “Let’s first do **capacity estimation** to understand what scale we’re designing for.”

---

##  Phase 1: Define the Problem Clearly

We are focusing on:

* **News Feed** = fetching posts of users someone follows.
* Not messaging, stories, or videos — just feed generation and viewing.

---

##  Phase 2: State Assumptions

You must clearly mention your assumptions (shows clarity).

Let’s assume:

| Metric                          | Value            | Notes                              |
| ------------------------------- | ---------------- | ---------------------------------- |
| Total Users                     | 100 million      | (MAU)                              |
| Daily Active Users (DAU)        | 50 million       | 50% active daily                   |
| Average Posts per User/day      | 2 posts/day      | includes photos & reels thumbnails |
| Average Followers per User      | 200 followers    | follower graph density             |
| Average Feed Views per User/day | 5 feed refreshes | each refresh loads ~20 posts       |
| Average Image Size              | 200 KB           | compressed JPEG                    |
| Average Post Metadata           | 500 bytes        | text, likes count, etc.            |
| Peak Load Factor                | 2×               | traffic spikes at morning/evening  |

---

##  Phase 3: Estimate Write Load (When Users Post)

Each active user uploads **2 posts/day**.

###  Total Posts per Day

```
= 50M active users × 2 posts
= 100 million new posts/day
```

###  Data Size per Post

Each post:

* Image: 200 KB
* Metadata: 0.5 KB
  → Total ≈ 200.5 KB ≈ **~200 KB** per post.

###  Total Data Generated per Day

```
= 100M × 200 KB
= 20,000,000,000 KB
= 20 TB/day
```

✅ So, **Instagram generates ~20 TB of new photo data every day.**

This goes into:

* **Blob storage (like AWS S3)**
* **Metadata DB (like Cassandra/MySQL)**

---

##  Phase 4: Estimate Read Load (When Users View Feeds)

Each user refreshes feed **5 times/day**.
Each refresh loads **20 posts** → **100 posts/day per user**.

###  Total Feed Posts Delivered Per Day

```
= 50M users × 100 posts
= 5 billion posts/day served
```

Each post is about 200 KB (image + metadata).

```
5B × 200 KB = 1,000,000,000,000 KB = 1 PB/day (Petabyte!)
```

 So the feed delivery side moves roughly **1 petabyte/day** of data to users.

That’s **massive**, which is why caching and CDNs are *critical*.

---

##  Phase 5: Calculate Requests Per Second (RPS)

Now let’s find the throughput — how many requests per second Instagram’s servers must handle.

There are **two main operations**:

1. **Feed reads** (fetching posts)
2. **Post uploads** (writing new posts)

Let’s convert daily numbers → per second.

###  Feed Read RPS

```
Feed reads/day = 50M users × 5 = 250M feed requests/day
= 250M / 86400 ≈ 2,893 reads/sec (avg)
Peak ≈ 2 × 2,893 = 5,786 reads/sec
```

But each feed request fetches **20 posts**, so:

```
Total post reads/sec = 5,786 × 20 = 115,720 post reads/sec
```

Roughly **~100K post reads/sec**.

---

###  Post Write RPS

```
Posts/day = 100M
= 100M / 86400 ≈ 1,157 posts/sec (avg)
Peak ≈ 2 × 1,157 = 2,314 writes/sec
```

 Roughly **~2K writes/sec**.

---

### Summary of Throughput

| Operation              | Avg RPS | Peak RPS | Notes                                 |
| ---------------------- | ------- | -------- | ------------------------------------- |
| Post Upload            | 1.1K    | 2.3K     | write-heavy but less frequent         |
| Feed Fetch             | 58K     | 115K     | read-heavy                            |
| Image Fetch (from CDN) | ~1M     | ~2M      | actual image delivery at global scale |

---

##  Phase 6: Estimate Storage

We already saw:

* 20 TB/day of new posts.

Now, suppose we keep data for **5 years**.

```
20 TB/day × 365 × 5 = 36,500 TB = 36.5 PB (Petabytes!)
```

 Instagram would need **tens of petabytes** for image storage — which aligns with real-world CDN + blob storage systems.

---

### Metadata (like post info, likes, comments)

Let’s assume metadata = 500 bytes/post.

```
100M posts/day × 500 bytes = 50 GB/day
For 5 years = 50 GB × 365 × 5 = 91 TB
```

So:

* **Image storage (S3)** → 36 PB
* **Metadata storage (DB)** → ~100 TB

---

##  Phase 7: Estimate Bandwidth Usage

### Upload Bandwidth

Post upload = 200 KB each × 2.3K uploads/sec = 460 MB/sec

→ **~3.7 Gbps** for uploads (to servers).

###  Download Bandwidth (Serving Feeds)

100K posts/sec × 200 KB = 20,000,000 KB/sec = 20 GB/sec

→ **~160 Gbps** outgoing bandwidth!

Hence, **Instagram uses CDNs (like Akamai, CloudFront, or its own edge servers)** to serve static content near users and reduce bandwidth load.

---

##  Phase 8: Estimate Server Count

Let’s assume:

* 1 web server can handle ~500 RPS comfortably
* 1 feed request ≈ 1 complex query (maybe multiple microservices)

### App Servers

For 115K RPS (peak feed reads):

```
115K / 500 = 230 servers
Add 30% buffer = ~300 servers
```

### DB Servers

Writes: 2K RPS → easily handled by a **sharded DB cluster**
Reads: 100K/sec → use caching + replicas

Assume:

* Each DB shard can handle ~5K RPS
* Need 20–30 read replicas (with caching in front)

✅ App servers ≈ 300
✅ DB shards ≈ 20–30
✅ Cache nodes (Redis) ≈ 50–100
✅ CDN edges = hundreds globally

---

##  Phase 9: Cache Estimation

80% of feed reads are served from cache.

```
Total post reads/day = 5B
Cache hit ratio = 80% → 4B cache hits/day
```

Each post = 200 KB

```
4B × 200 KB = 800 TB/day (cached content served)
```

Assume cache stores only recent posts (~7 days old).

```
100M posts/day × 7 = 700M posts
Each = 200 KB → 140 TB cache size
```

✅ Cache cluster needs ~140 TB total memory
→ spread across many Redis or Memcached nodes.

---

##  Phase 10: Scalability Insights

From these numbers, we learn:

| Component       | Scaling Method                      | Reason                                   |
| --------------- | ----------------------------------- | ---------------------------------------- |
| Web/App Servers | Horizontal scaling                  | To handle user traffic                   |
| Databases       | Sharding + Replication              | To handle 2K writes/sec + 100K reads/sec |
| Cache           | Distributed cache (Redis/Memcached) | To handle hot feed reads                 |
| Image Storage   | Blob storage + CDN                  | For petabytes of images                  |
| Bandwidth       | CDNs + Compression                  | To reduce latency & cost                 |

---

##  Final Summary Table

| Metric                  | Value     |
| ----------------------- | --------- |
| Total Users             | 100M      |
| DAU                     | 50M       |
| New Posts/day           | 100M      |
| Feed Requests/day       | 250M      |
| Peak Feed RPS           | ~115K     |
| Peak Post Writes        | ~2K       |
| Data Ingestion/day      | ~20 TB    |
| Image Storage (5 years) | ~36 PB    |
| App Servers             | ~300      |
| Cache Memory            | ~140 TB   |
| Outgoing Bandwidth      | ~160 Gbps |

---

##  Key Takeaways

1. **Instagram’s scale is dominated by reads (feeds)**, not writes (uploads).
2. **Caching and CDN are absolutely essential** — without them, bandwidth and latency would kill the system.
3. **Metadata storage** (likes, comments) fits in distributed databases.
4. **Feed generation** uses background workers and fanout queues (we’ll discuss later).
5. **Capacity planning is not exact — it’s directional**, showing you understand which parts of the system are heavy.

---

 **So, capacity estimation helps you answer:**

> “How big should my system be, and where are the bottlenecks likely to appear?”

---
